---
title: "作用域和变量提升"
date: "2020-01-23"
permalink: "notes/2020-01-23-scope-and-hoisting"
---

⚡<strong>「内容速览」</strong>⚡

- 作用域
- 作用域链
- 变量提升

### 作用域

- 什么时作用域？

在JS中作用域就是变量和函数的可访问范围（作用范围 / 生效的区域），它控制着变量和函数的可见性和生命周期。

作用域是指程序源代码中定义变量的区域，它规定了如何查找变量，也就是确定当前执行代码对变量的访问权限。

[详解JS作用域（一）](https://www.cnblogs.com/ruanmou/p/10219102.html)中对于js作用域描述非常好：作用域它负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。

- js作用域的类别：
1. 全局作用域：作用于script标签中JS代码，或一个独立的js文件中，全局作用域有一个全局对象window，window由浏览器创建。
2. 函数作用域：调用函数时创建，函数结束销毁，作用于函数内部代码。
3. 块级作用域（es6新增）：包括在{}中的代码。

- 作用域的层级关系：

假设我们有一个函数A嵌套在另一个函数B当中，这时就发生了作用域嵌套，当我们想在A函数中操作一个变量时，首先会在当前的函数作用域下查找，如果查找不到，会去到外层嵌套函数B的作用域下继续查找，直至找到变量或到全局作用域为止。

### 作用域链

**这里先引入几个概念，后续的文章中再继续补充和详解：**

- [[scope]]

当函数创建的时候，就会保存所有父变量对象到其中，[[scope]]可以理解就是所有外层变量对象的层级链。

- 作用域链
当函数执行时，会先创建执行上下文，这时就会将活动对象添加到作用链的前端。

当查找变量的时候，会先从当前上下文的变量对象中查找，如果没有找到，就会从函数外层(词法层面上的父级)执行上下文的变量对象中查找，一直找到全局上下文的变量对象，也就是全局对象。这样由多个执行上下文的变量对象构成的链表就叫做作用域链。

备注：内部函数访问外部函数的变量，采用的是链式查找的方式来决定取哪个值，这种结构称之为作用域链。查找时，采用的是就近原则。


### 变量提升
在js中，变量（这里指用var关键字声明的变量）和函数的声明提升至作用域的顶端。

- 变量的声明提前

理解下面的题目：
```js
console.log(a);
var a = 10;
function foo() {
  console.log(a);
  var a = 30;
  console.log(a);
}
foo();
console.log(a);

// 输出顺序，变量的声明会提升至作用域顶端
undefined
undefined
30
10
```

- 函数提升
通过函数关键字来创建的函数会被提前声明，而通过函数表达式声明的函数没有提升，因此我们在定义函数表达式之前不能使用函数表达式。

**函数的声明是优先于变量的声明的。**

此外在函数作用域内，如果声明变量没有使用var声明，那么它是全局变量，且不会声明提前。

```js
foo1() // foo1
function foo1() {
  console.log('foo1');
}

foo2() // TypeError: foo2 is not a function
var foo2 = function() {
  console.log('foo2');
}
```


参考链接：

[JavaScript深入之作用域链](https://github.com/mqyqingfeng/Blog/issues/6)