---
title: "http1.0、http1.1、http2.0"
date: "2020-01-30"
permalink: "notes/2020-01-30-http1.0-http1.1-http2.0"
---

⚡<strong>「内容速览」</strong>⚡

- http1.0
- http1.1
- http2.0

### http1.0
HTTP1.0最早在网页中使用是在1996年，主要使用一些较为简单的网页上和网络请求上，是一种无状态、无连接的应用层协议。

### http1.1
HTTP1.1则在1999年才开始广泛应用于现在的各大浏览器网络请求中，同时HTTP1.1也是当前使用最为广泛的HTTP协议，相较于http1.0，它主要的特点在于：

1. 长连接，在HTTP1.1中默认开启Connection： keep-alive，即在一个TCP连接上可以传送多个HTTP请求和响应，减少了建立和关闭连接的消耗和延迟。

2. 缓存处理，在HTTP1.0中主要使用header里的If-Modified-Since,Expires来做为缓存判断的标准，HTTP1.1则引入了更多的缓存控制策略例如cache-control，Entity tag，If-Unmodified-Since, If-Match, If-None-Match等更多可供选择的缓存头来控制缓存策略。

3. Host头处理，在HTTP1.0中认为每台服务器都绑定一个唯一的IP地址，因此，请求消息中的URL并没有传递主机名（hostname）。但随着虚拟主机技术的发展，在一台物理服务器上可以存在多个虚拟主机（Multi-homed Web Servers），并且它们共享一个IP地址。HTTP1.1的请求消息和响应消息都应支持Host头域，根据host字段来访问站点，并且请求消息中如果没有Host头域会报告一个错误（400 Bad Request）。

4. 带宽优化及网络连接的使用，HTTP1.0中，存在一些浪费带宽的现象，例如客户端只是需要某个对象的一部分，而服务器却将整个对象送过来了，并且不支持断点续传功能，HTTP1.1则在请求头引入了range头域，它允许只请求资源的某个部分，即返回码是206（Partial Content），这样就方便了开发者自由的选择以便于充分利用带宽和连接。

5. 错误通知的管理，在HTTP1.1中新增了24个错误状态响应码，如409（Conflict）表示请求的资源与资源的当前状态发生冲突；410（Gone）表示服务器上的某个资源被永久性的删除。

6. 此外，http1.1提出pipelining概念，即客户端可以在一个请求发送完成后不等待响应便直接发起第二个请求，服务端在返回响应时会按请求到达的顺序依次返回，这样就极大地降低了延迟。

### http2.0
为了优化HTTP1.X的请求延迟，提高web性能，谷歌基于SPDY的方案设计了http2.0，对于http2.0的特点，主要可以概况为：

1. 二进制分帧
2. 多路复用
3. 首部压缩
4. 请求优先级
5. 服务器推送
6. 流量控制

- 二进制分帧

应用层（HTTP）和传输层（TCP）之间增加一个二进制分帧层，它实现实现多路复用，改进传输性能的关键，这里涉及到三个关于帧的知识点：

  - 帧：HTTP2.0通信的最小单位，所有帧都共享一个8字节的首部，其中包含帧的长度、类型、标志、还有一个保留位，并且至少有标识出当前帧所属的流的标识符，帧承载着特定类型的数据，如HTTP首部、负荷、等等。

  - 消息：比帧大的通讯单位，是指逻辑上的HTTP消息，比如请求、响应等。由一个或多个帧组成 

  - 流：比消息大的通讯单位。建立连接上的双向字节流，是TCP连接中的一个虚拟通道，可以承载双向的消息。每个流都有一个唯一的整数标识符

在二进制分帧层上，HTTP2.0会将所有传输信息分割为更小的消息和帧，并对它们采用二进制格式的编码将其封装。

同时因为HTTP2.0通信都在一个TCP连接上完成，这个tcp连接可以承载任意数量的双向数据流，相应的每个数据流以消息的形式发送。而消息由一或多个帧组成，这些帧可以乱序交错发送，然后根据每个帧首部的流标识符重新组装。

- 多路复用

基于二进制分帧层的特点，HTTP2.0可以在共享TCP链接的基础上同时发送请求和响应。因为HTTP消息被分解为独立的帧，而不破坏消息本身的语义，交错发出去，在另一端根据流标识符和首部将他们重新组装起来。

多路复用对性能优化：

1. 可以并行交错的发送请求和响应，这些请求和响应之间互不影响
2. 消除不必要的延迟，从而减少页面加载的时间

- 首部压缩

HTTP2.0在客户端和服务端之间使用首部表来跟踪和存储之前发送的键值对。请求与响应首部的定义在HTTP2.0中基本没有变，只是所有首部键必须全部小写，而且要求行要独立为:method:、:scheme:、:host:、:path:这些键值对。

对于相同的数据，不再重新通过每次请求和响应发送。每个新的首部键值对要么追加到当前表的末尾，要么替换表中之前的值。首部表在HTTP2.0的链接存续期内始终存在，由客户端和服务端共同渐进的更新。

首部压缩对性能优化：

1. 首部压缩使报头更紧凑，更快速传输，有利于移动网络环境。减少每次通讯的数据量，使网络拥塞状态得以改善。

- 请求优先级

每个流都可以带有一个31bit的优先值：0表示最高优先级；2的31次方-1表示最低优先级。

服务器可以根据流的优先级控制资源分配（CPU、内存、宽带），而在响应数据准备好之后，优先将最高优先级的帧发送给客户端。浏览器可以在发现资源时立即分派请求，指定每个流的优先级，让服务器决定最优的响应次序。

- 服务器推送

服务器可以对一个客户端请求发送多个响应，推送额外的资源给客户端。

- 流量控制

HTTP2.0为数据流和连接的流量提供了一个简单的机制：

  - 流量基于HTTP链接的每一跳进行，而非端到端的控制
  - 流量控制基于窗口更新帧进行，即接收方广播自己准备接收某个数据流的多少字节，以及对整个链接要接收多少个字节。
  - 流量控制有方向性，即接收方可能根据自己的情况为没个流乃至整个链接设置任意窗口大小
  - 流量控制可以由接收方禁用，包括针对个别的流和针对整个链接。
  - 帧的类型决定了流量控制是否适用于帧，目前只有DATA帧服从流量控制，所有其他类型的帧并不会消耗流量控制窗口的空间。这保证了重要的控制帧不会被流量控制阻塞


参考链接：

[HTTP1.0、HTTP1.1 和 HTTP2.0 的区别](https://www.cnblogs.com/heluan/p/8620312.html)

[HTTP----HTTP2.0新特性](https://juejin.cn/post/6844903545532071943)
