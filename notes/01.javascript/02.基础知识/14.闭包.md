---
title: "闭包"
date: "2020-01-25"
permalink: "notes/2020-01-25-closure"
---

⚡<strong>「内容速览」</strong>⚡

- 闭包的概念
- 词法作用域
- 闭包的作用和缺点
- 闭包的应用

### 闭包的概念
MDN： 一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包（closure）。

其实我们可以把闭包看作是一种现象，这种现象让你可以在一个内层函数中访问到其外层函数的作用域（强调一下是局部局部变量）。

闭包产生的两个条件：
- 形成函数嵌套
- 内部函数引用了外部函数的变量或函数。

闭包会在函数创建的同时被创建出来。

// 闭包例子：
```js
function foo1() {
  let name = 'summer';
  return function foo2() {
    console.log(name);
  }
}

const foo = foo1();
foo(); // summer 
// 当foo1执行完成后依然可以访问到summer
```

### 词法作用域
词法作用域（静态作用域）根据源代码中声明变量的位置来确定该变量在何处可用，嵌套函数可访问声明于它们外部作用域的变量。

简单来说，词法作用域在我们编写代码时候就确定了，它是一套关于引擎如何寻找变量以及会在何处找到变量的规则。

### 闭包的作用和缺点
作用：
1. 阻止变量被GC垃圾回收，在函数执行完成，由于变量被引用，延长变量的生命周期。
2. 实现某些特性，函数外部可以读取函数内部的数据，利用这一特性可以实现私有变量和私有方法。

缺点：
1. 使用不当造成内存泄漏：由于闭包会使得函数内部变量长期保存在内存当中，不会被GC垃圾回收机制回收。

### 闭包的应用
- 封装具有特定功能的模块

将某些数据变量和功能封装在函数内部中，对外暴露一个公共对象，模块使用者通过引入该对象，就可以使用模块中对外暴露的方法。

```js
// 封装请求模块
function requestModule() {
  const baseUrl = 'http://www.xxx.com/api';
  function fetchApi (url) {
    // dosomething
    ...
  }
  return {
    fetchApi
  }
}
```