---
title: "闭包"
date: "2020-01-25"
permalink: "notes/2020-01-25-closure"
---

⚡<strong>「内容速览」</strong>⚡

- 闭包的概念
- 词法作用域
- 闭包的特点
- 闭包的作用和缺点
- 闭包的应用

### 闭包的概念
MDN： 一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包（closure）。

js闭包的本质源自于两点：词法作用域和函数作为值进行传递。

词法作用域在编写代码的时候就确定了，它会根据代码中声明变量所在的位置来确定该变量在哪里可用，例如内层函数可以访问到外层函数的变量，而外层不能访问到内层变量，它就是一套引擎在代码解释执行时寻找变量的规则。

而函数作为值传递，就是js中函数是第一公民，也就是可以作为另一个函数的参数，作为函数的返回值，以及赋值给变量。

而闭包就是这些特性而产生一种现象，当内部函数可以引用外部函数的变量，并且内部函数作为一个值保存下来，外层函数的变量在执行时创建，本应在执行完成后销毁，但因为被引用而保存下来，使得我们在函数执行完成后依旧可以访问内部变量，这时候就形成了闭包。闭包会在函数创建的同时被创建出来。

闭包产生的两个条件：
- 形成函数嵌套
- 内部函数引用了外部函数的变量或函数。


// 闭包例子：
```js
function foo1() {
  let name = 'summer';
  return function foo2() {
    console.log(name);
  }
}

const foo = foo1();
foo(); // summer 
// 当foo1执行完成后依然可以访问到summer
```

### 词法作用域
词法作用域（静态作用域）根据源代码中声明变量的位置来确定该变量在何处可用，嵌套函数可访问声明于它们外部作用域的变量。

简单来说，词法作用域在我们编写代码时候就确定了，它是一套关于引擎如何寻找变量以及会在何处找到变量的规则。

### 闭包的特点
- 让外部访问函数内部变量成为可能

- 局部变量会常驻在内存中

- 可以避免使用全局变量，防止全局变量污染

- 会造成内存泄漏（有一块内存空间被长期占用，而不被释放）

### 闭包的作用和缺点
作用：
1. 阻止变量被GC垃圾回收，在函数执行完成，由于变量被引用，延长变量的生命周期。
2. 实现某些特性，函数外部可以读取函数内部的数据，利用这一特性可以实现私有变量和私有方法。

缺点：
1. 使用不当造成内存泄漏：由于闭包会使得函数内部变量长期保存在内存当中，不会被GC垃圾回收机制回收。

### 闭包的应用
- 封装具有特定功能的模块

将某些数据变量和功能封装在函数内部中，对外暴露一个公共对象，模块使用者通过引入该对象，就可以使用模块中对外暴露的方法。

```js
// 封装请求模块
function requestModule() {
  const baseUrl = 'http://www.xxx.com/api';
  function fetchApi (url) {
    // dosomething
    ...
  }
  return {
    fetchApi
  }
}
```