---
title: "js垃圾回收"
date: "2020-02-08"
permalink: "notes/2020-02-08-garbage-collection"
---

⚡<strong>「内容速览」</strong>⚡

- 垃圾回收
- 如何判断垃圾
- 标记清除
- 引用计数


### 垃圾回收
在js中，创建基本类型、对象、函数这些都需要使用到内存，而javascript有自己的内存管理机制，可以自动对无用的内存（垃圾）进行回收，从而让我们不必担心这些变量的销毁和内存回收。

JavaScript垃圾回收的机制：找出不再使用的变量，然后释放掉其占用的内存，但是这个过程不是实时的，因为这个过程开销比较大，所以垃圾回收器会按照固定的时间间隔周期性的执行。

### 如何判断垃圾
JavaScript的垃圾回收算法主要依赖于引用的概念，失去引用的变量就称为垃圾。

### 标记清除
垃圾回收器会在运行的时候给存储在内存中的所有变量加上标记，然后去掉环境中的变量以及被环境中变量所引用的变量（闭包）的标记，之后仍存在标记的就是要删除的变量了，因为环境中的变量已经无法访问到这些变量了，然后垃圾回收器会回收这些带有标记的变量所占空间。

### 引用计数
跟踪记录每个值被引用的次数，当值被引用时引用次数就加1，失去引用时引用次数减1，当这个值的引用次数变为0的时候，说明这个值没法被访问了，可以回收其占用的空间，然后垃圾回收器会在运行的时候清理掉引用次数为0的值占用的空间。

- 存在问题

对于循环引用，由于两个变量都至少被引用依次，因此引用计数策略永远无法回收变量。

```js
function foo() {
  var a = {
    obj: null
  };
  var b = {
    obj: null
  };
  a.obj = b;
  b.obj = a;
}
foo()
```
当函数执行完后a,b变量都至少被引用一次，无法被引用计数策略回收。

对于标记清除，在函数调用返回后，a，b对象的循环引用无法从全局对象出发获取，因此它们都会被垃圾回收器回收。

参考链接：

[JS 垃圾回收的两种方式](https://blog.csdn.net/weixin_33862514/article/details/91424184)

[JavaScript 垃圾回收](https://www.cnblogs.com/dolphinX/p/3348468.html)



