---
title: "前端优化方案"
date: "2020-02-15"
permalink: "exam/2020-02-15-exam-url-to-show"
---

⚡<strong>「内容速览」</strong>⚡

- 页面加载过程的优化
- 减少HTTP请求
- 使用http2.0
- 利用缓存，减少重复资源的加载
- CDN（内容分发网络Content Delivery Network）加速
- 压缩文件
- 图片加载优化
- 代码分割，实现按需加载，提取第三方库
- 使用 Web Workers
- ssr服务端渲染
- 减少重绘重排
- 使用事件委托
- 代码优化
- 使用 requestAnimationFrame 来实现视觉变化
- 降低 CSS 选择器的复杂性
- 使用 transform 和 opacity 属性更改来实现动画


### 页面加载过程的优化
优化cssom：CSS 加载不会阻塞 DOM 的解析，但由于 Render Tree 是依赖于 DOM Tree 和 CSSOM Tree 的，所以他必须等待到 CSSOM Tree 构建完成，才能开始渲染。因此，CSS 加载会阻塞 Dom 的渲染。因此CSS 文件放在头部。

优化 JavaScript：
当浏览器遇到 script 标记时，会阻止解析器执行，下载js脚本，直到 CSSOM 构建完毕，JavaScript 才会运行并继续完成 DOM 构建过程。

### 减少 HTTP 请求
每次http请求都需要向服务器发送请求然后等待响应，我们可以将多个小文件合并成一个大文件，从而减少http请求次数。

### 使用http2.0
http2.0二进制分帧，多路复用，首部压缩，服务端推送等特点能够对http请求进行优化。

### 利用缓存，减少重复资源的加载
请求文件设置max-age，ETag等缓存标记。

可以通过更新页面中引用的资源链接地址，让浏览器主动放弃缓存，加载新资源。具体做法是把资源地址 URL 的修改与文件内容关联起来，也就是说，只有文件内容变化，才会导致相应 URL 的变更，从而实现文件级别的精确缓存控制。

### CDN（内容分发网络Content Delivery Network）加速
（1）CDN的加速资源是跟域名绑定的。
（2）通过域名访问资源，首先是通过DNS分查找离用户最近的CDN节点（边缘服务器）的IP
（3）通过IP访问实际资源时，如果CDN上并没有缓存资源，则会到源站请求资源，并缓存到CDN节点上，这样，用户下一次访问时，该CDN节点就会有对应资源的缓存了。

### 压缩文件
压缩文件可以减少文件下载时间，让用户体验性更好。gzip 是目前最流行和最有效的压缩方法。

### 图片加载优化
（1）在页面中，先不给图片设置路径，只有当图片出现在浏览器的可视区域时，才去加载真正的图片，这就是延迟加载。对于图片很多的网站来说，一次性加载全部图片，会对用户体验造成很大的影响，所以需要使用图片延迟加载。

（2）降低图片质量，对图片质量进行压缩，使用webp格式图片，WebP 的优势体现在它具有更优的图像数据压缩算法，能带来更小的图片体积，而且拥有肉眼识别无差异的图像质量。

（3）利用 CSS3 效果代替图片

（4）响应式图片

### 代码分割，实现按需加载，提取第三方库

动态引入组件实现按需加载：根据代码在一些逻辑断点处分离开，然后在一些代码块中完成某些操作后，立即引用或即将引用另外一些新的代码块。这样加快了应用的初始加载速度，减轻了它的总体体积，因为某些代码块可能永远不会被加载。 

提取第三方库：由于引入的第三方库一般都比较稳定，不会经常改变。所以将它们单独提取出来，作为长期缓存是一个更好的选择。

### 使用 Web Workers
Web Worker 使用其他工作线程从而独立于主线程之外，它可以执行任务而不干扰用户界面。一个 worker 可以将消息发送到创建它的 JavaScript 代码, 通过将消息发送到该代码指定的事件处理程序（反之亦然）。

Web Worker 适用于那些处理纯数据，或者与浏览器 UI 无关的长时间运行脚本。

### ssr服务端渲染
服务端直接返回页面的html，客户端解析执行。

### 减少重绘重排
如果要对 DOM 元素执行一系列操作，可以将 DOM 元素脱离文档流，修改完成后，再将它带回文档。推荐使用隐藏元素（display:none）或文档碎片（DocumentFragement），都能很好的实现这个方案。

### 使用事件委托
事件委托利用了事件冒泡，只指定一个事件处理程序，就可以管理某一类型的所有事件。所有用到按钮的事件（多数鼠标事件和键盘事件）都适合采用事件委托技术， 使用事件委托可以节省内存。

### 代码优化

（1）注意程序的局部性

局部性通常有两种不同的形式：

- 时间局部性：在一个具有良好时间局部性的程序中，被引用过一次的内存位置很可能在不远的将来被多次引用。
- 空间局部性 ：在一个具有良好空间局部性的程序中，如果一个内存位置被引用了一次，那么程序很可能在不远的将来引用附近的一个内存位置。

（2）switch代替多个if-else，或者可以通过查找表

（3）使用位操作，位操作也比其他数学运算和布尔操作快得多

### 使用 requestAnimationFrame 来实现视觉变化
从第 16 点我们可以知道，大多数设备屏幕刷新率为 60 次/秒，也就是说每一帧的平均时间为 16.66 毫秒。在使用 JavaScript 实现动画效果的时候，最好的情况就是每次代码都是在帧的开头开始执行。而保证 JavaScript 在帧开始时运行的唯一方式是使用 requestAnimationFrame。

### 降低 CSS 选择器的复杂性

浏览器读取选择器，遵循的原则是从选择器的右边到左边读取。

- 选择器越短越好。
- 尽量使用高优先级的选择器，例如 ID 和类选择器。
- 避免使用通配符 *。


### 使用 transform 和 opacity 属性更改来实现动画
在 CSS 中，transform 和 opacity 这两个属性更改不会触发重排与重绘，它们是可以由合成器（composite）单独处理的属性。


参考链接：

[前端性能优化 24 条建议(2020)](https://zhuanlan.zhihu.com/p/121056616)

[前端性能优化小结（面试干货）](https://zhuanlan.zhihu.com/p/115047733)






